<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AR pur - Tracking Hiro avec environnement VR interactif</title>

  <!-- A-Frame, AR.js et gestes -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #info {
      position: absolute; bottom: 20px; left: 0; width: 100%;
      text-align: center; color: white; font-family: sans-serif;
      background: rgba(0,0,0,0.6); padding: 10px; box-sizing: border-box;
      pointer-events: none; z-index: 100;
    }
  </style>
</head>
<body>
  <div id="info">ðŸ”µ Pointez le marqueur Hiro â†’ lâ€™environnement apparaÃ®t et suit le marqueur. Pincez pour manipuler les objets.</div>

  <!-- ScÃ¨ne AR.js : le fond est la camÃ©ra, pas de ciel -->
  <a-scene embedded
           arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
           renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true;">

    <a-assets>
      <!-- Images et vidÃ©os publiques -->
      <img id="img1" src="https://picsum.photos/200/200?random=1">
      <img id="img2" src="https://picsum.photos/200/200?random=2">
      <img id="img3" src="https://picsum.photos/200/200?random=3">
      <img id="img4" src="https://picsum.photos/200/200?random=4">
      
      <video id="video1" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" 
             preload="auto" loop crossorigin="anonymous" playsinline webkit-playsinline></video>
      <video id="video2" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4" 
             preload="auto" loop crossorigin="anonymous" playsinline webkit-playsinline></video>
      
      <img id="grid" src="https://cdn.aframe.io/a-painter/images/grid.png">
    </a-assets>

    <!-- ===== MARQUEUR HIRO ===== -->
    <!-- Tout le contenu 3D est attachÃ© ici et suit le marqueur -->
    <a-marker preset="hiro" id="marker" emitevents="true">
      
      <!-- Environnement VR/3D posÃ© sur le marqueur -->
      <a-entity id="vr-world" position="0 0 0" scale="1 1 1">
        
        <!-- Sol avec grille (effet VR) mais semi-transparent pour voir le sol rÃ©el -->
        <a-circle id="ground" radius="3" rotation="-90 0 0" position="0 0 0"
                  material="src: #grid; repeat: 8 8; transparent: true; opacity: 0.2; color: #4FC3F7"></a-circle>
        
        <!-- LumiÃ¨res -->
        <a-light type="ambient" color="#4455FF" intensity="0.3"></a-light>
        <a-light type="directional" color="#FFFFFF" intensity="0.8" position="2 5 3"></a-light>
        
        <!-- ===== OBJETS INTERACTIFS (gestes) ===== -->
        <!-- VidÃ©o 1 -->
        <a-video src="#video1" class="interactable"
                 position="-1.2 0.5 0" rotation="-90 0 0" width="1.2" height="0.68"
                 gesture-handler></a-video>
        
        <!-- VidÃ©o 2 -->
        <a-video src="#video2" class="interactable"
                 position="1.2 0.5 0" rotation="-90 0 0" width="1.2" height="0.68"
                 gesture-handler></a-video>
        
        <!-- Images disposÃ©es autour -->
        <a-image src="#img1" class="interactable"
                 position="-0.8 0.2 -1" rotation="-90 0 0" width="0.6" height="0.6"
                 gesture-handler></a-image>
        <a-image src="#img2" class="interactable"
                 position="0.8 0.2 -1" rotation="-90 0 0" width="0.6" height="0.6"
                 gesture-handler></a-image>
        <a-image src="#img3" class="interactable"
                 position="-0.8 0.2 1" rotation="-90 0 0" width="0.6" height="0.6"
                 gesture-handler></a-image>
        <a-image src="#img4" class="interactable"
                 position="0.8 0.2 1" rotation="-90 0 0" width="0.6" height="0.6"
                 gesture-handler></a-image>
        
        <!-- Titre flottant -->
        <a-text value="AR ENVIRONMENT" position="0 1 0" rotation="-90 0 0" 
                align="center" width="2" color="#FFC65D"></a-text>
        
        <!-- Petit cube dÃ©coratif -->
        <a-box position="0 0.5 -0.5" color="#4FC3F7" width="0.15" height="0.15" depth="0.15"
               animation="property: rotation; to: 0 360 0; dur: 4000; loop: true"></a-box>
        
      </a-entity> <!-- fin vr-world -->
    </a-marker>

    <!-- CamÃ©ra fixe (nÃ©cessaire pour AR.js) -->
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // === INTERACTIONS VIDÃ‰O : lecture/pause au clic ===
    document.addEventListener('click', function (evt) {
      const el = evt.target;
      if (el.classList && el.classList.contains('interactable') && el.tagName.toLowerCase() === 'a-video') {
        const src = el.getAttribute('src');
        if (!src) return;
        const video = document.querySelector(src);
        if (video) {
          if (video.paused) {
            video.play().catch(e => console.log("Lecture impossible", e));
            // feedback visuel
            el.setAttribute('scale', '1.1 1.1 1.1');
            setTimeout(() => el.setAttribute('scale', '1 1 1'), 200);
          } else {
            video.pause();
          }
        }
      }
    });

    // PrÃ©chargement des vidÃ©os
    window.addEventListener('load', () => {
      document.querySelectorAll('video').forEach(v => {
        v.load();
        // Permet le dÃ©clenchement ultÃ©rieur par l'utilisateur
      });
    });
  </script>
</body>
</html>
